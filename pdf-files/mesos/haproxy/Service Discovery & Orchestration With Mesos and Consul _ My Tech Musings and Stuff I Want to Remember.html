<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0084)http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Service Discovery &amp; Orchestration With Mesos and Consul | My Tech Musings and Stuff I Want to Remember</title>
<link rel="stylesheet" href="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/style.css" type="text/css" media="screen">
<link rel="pingback" href="http://philzim.com/xmlrpc.php">
<link rel="alternate" type="application/rss+xml" title="My Tech Musings and Stuff I Want to Remember » Feed" href="http://philzim.com/feed/">
<link rel="alternate" type="application/rss+xml" title="My Tech Musings and Stuff I Want to Remember » Comments Feed" href="http://philzim.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="My Tech Musings and Stuff I Want to Remember » Service Discovery &amp; Orchestration With Mesos and Consul Comments Feed" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/feed/">
		<script id="twitter-wjs" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/widgets.js"></script><script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/philzim.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.2"}};
			!function(a,b,c){function d(a){var c,d=b.createElement("canvas"),e=d.getContext&&d.getContext("2d"),f=String.fromCharCode;return e&&e.fillText?(e.textBaseline="top",e.font="600 32px Arial","flag"===a?(e.fillText(f(55356,56806,55356,56826),0,0),d.toDataURL().length>3e3):"diversity"===a?(e.fillText(f(55356,57221),0,0),c=e.getImageData(16,16,1,1).data.toString(),e.fillText(f(55356,57221,55356,57343),0,0),c!==e.getImageData(16,16,1,1).data.toString()):("simple"===a?e.fillText(f(55357,56835),0,0):e.fillText(f(55356,57135),0,0),0!==e.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/wp-emoji-release.min.js" type="text/javascript"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="wp-markdown-prettify-css" href="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/prettify.css" type="text/css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/jetpack.css" type="text/css" media="all">
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/jquery.min.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/custom-jquery-script.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/prettify.min.js"></script>
<link rel="https://api.w.org/" href="http://philzim.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://philzim.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://philzim.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Using FPM to Build Git rpms" href="http://philzim.com/2014/10/13/using-fpm-to-build-git-rpms/">
<meta name="generator" content="WordPress 4.4.2">
<link rel="canonical" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/">
<link rel="shortlink" href="http://philzim.com/?p=100">
<link rel="alternate" type="application/json+oembed" href="http://philzim.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fphilzim.com%2F2014%2F11%2F12%2Fservice-discovery-orchestration-with-mesos-and-consul%2F">
<link rel="alternate" type="text/xml+oembed" href="http://philzim.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fphilzim.com%2F2014%2F11%2F12%2Fservice-discovery-orchestration-with-mesos-and-consul%2F&amp;format=xml">

<link rel="dns-prefetch" href="http://i0.wp.com/">
<link rel="dns-prefetch" href="http://i1.wp.com/">
<link rel="dns-prefetch" href="http://i2.wp.com/">
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<style type="text/css" id="syntaxhighlighteranchor"></style>
<script type="text/javascript" charset="utf-8" async="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/timeline.d11f7a3b3287fb94220e8ee6d03cc772.js"></script></head>
<body class="single single-post postid-100 single-format-standard">
<div class="wrapperBg">
<!-- Start: Main Container -->
<div class="mainCont">
	<!-- Start: Header -->
	<div class="header">
		<h1><a href="http://philzim.com/">My Tech Musings and Stuff I Want to Remember</a></h1>
		<h2></h2>
		<form method="get" id="searchform" action="http://philzim.com/" class="searchForm">
	<p><input type="text" value="" name="s" id="s" class="field">
	<input type="image" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/go-btn.gif" title="Search" id="searchsubmit" class="btn"></p>
</form>
	</div>
	<!-- End: Header -->
	<!-- Start: Header menu -->
	<div class="headerMenu">
		<span></span>
		<span class="rightBg"></span>
			<ul class="menu"><li class="page_item page-item-2"><a href="http://philzim.com/sample-page/">About Me</a></li>
</ul> 
	</div>
	<div class="clear"></div>
	<!-- End: Header menu -->
	<!-- Start: Body Content -->
	<div class="bodyContent">

	<!-- Start: Left Panel -->
	<div class="leftPanel">

	
		<div class="post-100 post type-post status-publish format-standard hentry category-consul-2 category-docker category-mesos category-paas tag-consul tag-docker tag-haproxy tag-marathon tag-mesos tag-orchestration tag-service-discovery tag-service-registration" id="post-100">
			<h2>Service Discovery &amp; Orchestration With Mesos and Consul</h2>

			<div class="entryContent">
				<h1>A Practical Solution That Implements Service Registration/Discovery Using Apache Mesos and Consul</h1>
<p>The topic of Docker and how to incorporate it into an actual real-world solution has been on my mind for a while now. I’ve read a lot of articles and blog posts related to service discovery and orchestration for Docker workflows. Service discovery and orchestration were always the keys in my mind for achieving a functional, usable means for incorporating Docker into any toolchain. In addition to service discovery, high availability and fault tolerance are almost equally important to ensure containerized apps and services are highly performant and available.</p>
<p>A couple weeks ago Jeff Scelza, Greg Wobermin and I had the opportunity to spend a labweek focusing on creating a solution using what we feel are some best-of-breed tools in this space. We chose to utilize <a href="http://mesos.apache.org/">Apache Mesos</a> and <a href="https://mesosphere.com/">Mesosphere’s</a> Marathon for Docker job scheduling and deployment. Mesos helps achieve high availability and fault tolerance and is battle-proven. As for service orchestration and discovery, Hashicorp’s <a href="https://consul.io/">Consul</a> was the favorite due to its ability to not only serve as a key/value store, but also its support of fault detection and multi datacenter awareness.</p>
<p>The last two tools that we incorporated into our solution are Jeff Lindsay’s <a href="https://github.com/progrium/registrator">registrator</a> and Hashicorp’s <a href="https://github.com/hashicorp/consul-template">consul-template</a>.</p>
<p>Registrator is a docker container that detects when other containers start and stop, and registers/de-registers the container’s service name and published port in Consul. Consul-template is a standalone app that queries Consul and updates a file template on the filesystem. As you will see later, the combination of registrator with Consul/Consul-template are the required parts that help achieve dynamic service registration/discovery and configuration file updates to make all of this happen. We utilize these tools in conjunction with Haproxy to provide a common proxy to front all service requests.</p>
<h1>Installing All Of the Necessary Components</h1>
<p>At TWC we run CentOS 6.5, therefore all of the following instructions are specific to this platform, except where noted otherwise. All of this was installed on our internal OpenStack environment.</p>
<h2>Setting Up Consul</h2>
<p>The desired production configuration for Consul is to have a 3 or 5 server cluster. In addition, each non-server node (including all mesos masters and slaves, haproxy, etc) must have a Consul agent installed and running.</p>
<p>In order to install Consul (server and agent nodes), follow these steps:</p>
<pre class="prettyprint prettyprinted"><code><span class="pln">wget https</span><span class="pun">:</span><span class="com">//dl.bintray.com/mitchellh/consul/0.4.1_linux_amd64.zip</span><span class="pln">
unzip </span><span class="lit">0.4</span><span class="pun">.</span><span class="lit">1</span><span class="pln">_linux_amd64</span><span class="pun">.</span><span class="pln">zip
cp consul </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">bin</span></code></pre>
<h3>Consul Server Setup</h3>
<p>We setup and configured 3 vms to serve as the Consul server cluster. Follow <a href="http://www.consul.io/docs/guides/bootstrapping.html">the server setup instructions</a> from the Consul website to setup the server cluster and establish leader election. If everything has been setup correctly, you should be able to run ‘consul members’ and see all the server nodes.</p>
<h3>Consul Agent Setup</h3>
<p>Follow <a href="http://www.consul.io/intro/getting-started/join.html">the agent setup instructions</a> from the Consul website to setup and general consul cluster.</p>
<p>If everything has been setup correctly, you should be able to run ‘consul members’ and see all the nodes (including the server nodes).</p>
<h2>Setting up the Mesos Masters</h2>
<h3>Installing the Mesosphere Stack (Mesos Master)</h3>
<p>At the time of this post, the instructions will help install Mesos version 0.20.1 and Marathon version 0.7.3.</p>
<p>We referenced the <a href="http://mesosphere.com/docs/getting-started/datacenter/install/#master-setup">Mesosphere Master Node Instructions</a> to install and configure the master nodes. We are running with 3 masters and setting a quorum of 2. Where this documentation comes up short is with regard to the python egg that’s required to use the start/stop scripts correctly on CentOS. After following the Mesosphere instructions, make sure you run the additional following commands:</p>
<p><strong>curl -sSfL http://downloads.mesosphere.io/master/redhat/6/mesos-0.20.1-py2.6-linux-x86_64.egg –output /tmp/mesos.egg</strong></p>
<p><strong>easy_install –allow-hosts pypi.python.org /tmp/mesos.egg</strong></p>
<p>Once you have everything configured correctly, start each mesos master using the following command:</p>
<p><strong>start mesos-master</strong></p>
<p>You should see the process running:</p>
<pre class="prettyprint prettyprinted"><code><span class="pun">[</span><span class="pln">root@mesos</span><span class="pun">-</span><span class="pln">master</span><span class="pun">-</span><span class="lit">01</span><span class="pln"> mesos</span><span class="pun">-</span><span class="pln">master</span><span class="pun">]#</span><span class="pln"> ps </span><span class="pun">-</span><span class="pln">ef </span><span class="pun">|</span><span class="pln"> grep master 
root </span><span class="lit">8978</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="typ">Oct29</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">00</span><span class="pun">:</span><span class="lit">09</span><span class="pun">:</span><span class="lit">47</span><span class="pln"> </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">mesos</span><span class="pun">-</span><span class="pln">master </span><span class="pun">--</span><span class="pln">zk</span><span class="pun">=</span><span class="pln">zk</span><span class="pun">:</span><span class="com">//1.1.1.1:2181,</span><span class="pln">
</span><span class="lit">2.2</span><span class="pun">.</span><span class="lit">2.2</span><span class="pun">:</span><span class="lit">2181</span><span class="pun">,</span><span class="lit">3.3</span><span class="pun">.</span><span class="lit">3.3</span><span class="pun">:</span><span class="lit">2181</span><span class="pun">/</span><span class="pln">mesos </span><span class="pun">--</span><span class="pln">port</span><span class="pun">=</span><span class="lit">5050</span><span class="pln"> </span><span class="pun">--</span><span class="pln">log_dir</span><span class="pun">=</span><span class="str">/var/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">mesos 
</span><span class="pun">--</span><span class="pln">hostname</span><span class="pun">=</span><span class="lit">1.1</span><span class="pun">.</span><span class="lit">1.1</span><span class="pln"> </span><span class="pun">--</span><span class="pln">quorum</span><span class="pun">=</span><span class="lit">2</span><span class="pln"> </span><span class="pun">--</span><span class="pln">work_dir</span><span class="pun">=</span><span class="str">/var/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">mesos 
root </span><span class="lit">8990</span><span class="pln"> </span><span class="lit">8978</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="typ">Oct29</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pln"> logger </span><span class="pun">-</span><span class="pln">p user</span><span class="pun">.</span><span class="pln">info </span><span class="pun">-</span><span class="pln">t mesos</span><span class="pun">-</span><span class="pln">master</span><span class="pun">[</span><span class="lit">8978</span><span class="pun">]</span><span class="pln"> 
root </span><span class="lit">8991</span><span class="pln"> </span><span class="lit">8978</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="typ">Oct29</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pln"> logger </span><span class="pun">-</span><span class="pln">p user</span><span class="pun">.</span><span class="pln">err </span><span class="pun">-</span><span class="pln">t mesos</span><span class="pun">-</span><span class="pln">master</span><span class="pun">[</span><span class="lit">8978</span><span class="pun">]</span></code></pre>
<h2>Setting up the Mesos Slaves</h2>
<h3>Installing Mesos Slave</h3>
<p>We referenced the <a href="http://mesosphere.com/docs/getting-started/datacenter/install/#slave-setup">Mesosphere Slave Node Instructions</a> to install and configure the slave nodes. Again, make sure you install the python egg that’s required to use the start/stop scripts correctly on CentOS. After following the Mesosphere instructions, make sure you run the additional following commands:</p>
<p><strong>curl -sSfL http://downloads.mesosphere.io/master/redhat/6/mesos-0.20.1-py2.6-linux-x86_64.egg –output /tmp/mesos.egg</strong></p>
<p><strong>easy_install –allow-hosts pypi.python.org /tmp/mesos.egg</strong></p>
<p>Now start the mesos slave:</p>
<p><strong>start mesos-slave</strong></p>
<p>Ensure the process is running:</p>
<pre class="prettyprint prettyprinted"><code><span class="pln">ps </span><span class="pun">-</span><span class="pln">ef </span><span class="pun">|</span><span class="pln"> grep slave
root </span><span class="lit">10749</span><span class="pln"> </span><span class="lit">3451</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="lit">11</span><span class="pun">:</span><span class="lit">03</span><span class="pln"> pts</span><span class="pun">/</span><span class="lit">0</span><span class="pln"> </span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pln"> grep slave 
root </span><span class="lit">15229</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="typ">Nov06</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">00</span><span class="pun">:</span><span class="lit">25</span><span class="pun">:</span><span class="lit">01</span><span class="pln"> </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">mesos</span><span class="pun">-</span><span class="pln">slave   
</span><span class="pun">--</span><span class="pln">master</span><span class="pun">=</span><span class="pln">zk</span><span class="pun">:</span><span class="com">//1.1.1.1:2181,2.2.2.2:2181,3.3.3.3:2181/mesos --log_dir=/var/log/mesos </span><span class="pln">
</span><span class="pun">--</span><span class="pln">containerizers</span><span class="pun">=</span><span class="pln">docker</span><span class="pun">,</span><span class="pln">mesos
</span><span class="pun">--</span><span class="pln">executor_registration_timeout</span><span class="pun">=</span><span class="lit">5mins</span><span class="pln"> </span><span class="pun">--</span><span class="pln">hostname</span><span class="pun">=</span><span class="lit">172.25</span><span class="pun">.</span><span class="lit">1.35</span><span class="pln">
root </span><span class="lit">15241</span><span class="pln"> </span><span class="lit">15229</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="typ">Nov06</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pln"> logger </span><span class="pun">-</span><span class="pln">p user</span><span class="pun">.</span><span class="pln">info </span><span class="pun">-</span><span class="pln">t mesos</span><span class="pun">-</span><span class="pln">slave</span><span class="pun">[</span><span class="lit">15229</span><span class="pun">]</span><span class="pln">
root </span><span class="lit">15242</span><span class="pln"> </span><span class="lit">15229</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="typ">Nov06</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pun">:</span><span class="lit">00</span><span class="pln"> logger </span><span class="pun">-</span><span class="pln">p user</span><span class="pun">.</span><span class="pln">err </span><span class="pun">-</span><span class="pln">t mesos</span><span class="pun">-</span><span class="pln">slave</span><span class="pun">[</span><span class="lit">15229</span><span class="pun">]</span></code></pre>
<p>Once you have the Mesos components installed and running correctly, you should be able to go to the Mesos console (running on port 5050) and see the slave is activated:</p>
<p><img src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/TmfdZqp.png" alt="mesos slave activated" width="262" height="115"></p>
<h3>Installing Docker</h3>
<pre class="prettyprint prettyprinted"><code><span class="pln">wget http</span><span class="pun">:</span><span class="com">//dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span><span class="pln">
rpm </span><span class="pun">-</span><span class="typ">Uvh</span><span class="pln"> epel</span><span class="pun">-</span><span class="pln">release</span><span class="pun">-</span><span class="lit">6</span><span class="pun">*.</span><span class="pln">rpm
yum install </span><span class="pun">-</span><span class="pln">y docker</span><span class="pun">-</span><span class="pln">io</span></code></pre>
<p>Configure daemon settings:</p>
<p>Ensure /etc/sysconfig/docker has the following settings:</p>
<p><strong>other_args=”-H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock”</strong></p>
<p>Start the daemon: service docker start</p>
<h3>Setting Up Registrator</h3>
<p>Pull the docker image:</p>
<p><strong>docker pull progrium/registrator</strong></p>
<p>Run the registrator container (ensure the Consul agent has been installed and is running):</p>
<p><strong>docker run -d -v /var/run/docker.sock:/tmp/docker.sock -h $HOSTNAME progrium/registrator consul://localhost:8500</strong></p>
<p>Run ‘docker logs’ on the registrator container id and you should see the following:</p>
<p><strong>2014/10/31 20:06:26 registrator: Using consul registry backend at consul://172.0.0.1:8500 2014/10/31 20:06:26 registrator: Listening for Docker events…</strong></p>
<h3>Setting up consul-template and haproxy</h3>
<p>Now we are at the point where we need to setup and configure our haproxy instance(s) with consul-template running in order to enable dynamic register/de-register of our services in haproxy.</p>
<p>Install haproxy on your vm, then install consul-template. Ensure Consul is installed and joined to the cluster. Refer to the Consul links above for reference. The latest release of consul-template can be downloaded here: https://github.com/hashicorp/consul-template/releases. At the time of this post, the latest was version 0.2.0.</p>
<pre class="prettyprint prettyprinted"><code><span class="pln">wget https</span><span class="pun">:</span><span class="com">//github.com/hashicorp/consul-template/releases/download/v0.2.0/</span><span class="pln">
consul</span><span class="pun">-</span><span class="pln">template_0</span><span class="pun">.</span><span class="lit">2.0</span><span class="pln">_linux_amd64</span><span class="pun">.</span><span class="pln">tar</span><span class="pun">.</span><span class="pln">gz

tar xvfz consul</span><span class="pun">-</span><span class="pln">template_0</span><span class="pun">.</span><span class="lit">2.0</span><span class="pln">_linux_amd64</span><span class="pun">.</span><span class="pln">tar</span><span class="pun">.</span><span class="pln">gz cp consul</span><span class="pun">-</span><span class="kwd">template</span><span class="pln"> </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">bin</span></code></pre>
<p>At this point haproxy, Consul and consul-template should be installed. Next we need to configure consul-template.</p>
<p>First, create a template config file. This file will be referenced when we start the consul-template daemon. In our instance, we created the file in /data/cfg/consul/tmpl.json:</p>
<pre class="prettyprint prettyprinted"><code><span class="pln">consul </span><span class="pun">=</span><span class="pln"> </span><span class="str">"127.0.0.1:8500"</span><span class="pln">

</span><span class="kwd">template</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  source </span><span class="pun">=</span><span class="pln"> </span><span class="str">"/etc/haproxy/haproxy.ctmpl"</span><span class="pln">
  destination </span><span class="pun">=</span><span class="pln"> </span><span class="str">"/etc/haproxy/haproxy.cfg"</span><span class="pln">
  command </span><span class="pun">=</span><span class="pln"> </span><span class="str">"service haproxy restart"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>As you can see, this file provides all the necessary values for consul-template to do its magic for our haproxy configuration. Now create the actual template file that will be used by consul-template to configure the haproxy.cfg file. We chose to put the template in the same directory as the haproxy.cfg. The interesting bits from the template look like this:</p>
<pre class="prettyprint prettyprinted"><code><span class="pln">defaults REDIS
    mode tcp
    timeout connect  </span><span class="lit">4s</span><span class="pln">
    timeout server  </span><span class="lit">30s</span><span class="pln">
    timeout client  </span><span class="lit">30s</span><span class="pln">

listen http</span><span class="pun">-</span><span class="kwd">in</span><span class="pln">
    bind </span><span class="pun">*:</span><span class="lit">80</span><span class="pun">{{</span><span class="pln">range service </span><span class="str">"web"</span><span class="pun">}}</span><span class="pln">
        server </span><span class="pun">{{.</span><span class="typ">Node</span><span class="pun">}}</span><span class="pln"> </span><span class="pun">{{.</span><span class="typ">Address</span><span class="pun">}}:{{.</span><span class="typ">Port</span><span class="pun">}}{{</span><span class="kwd">end</span><span class="pun">}}</span><span class="pln">
listen http</span><span class="pun">-</span><span class="kwd">in</span><span class="pln">
    bind </span><span class="pun">*:</span><span class="lit">4567</span><span class="pun">{{</span><span class="pln">range service </span><span class="str">"demoapp"</span><span class="pun">}}</span><span class="pln">
        server </span><span class="pun">{{.</span><span class="typ">Node</span><span class="pun">}}</span><span class="pln"> </span><span class="pun">{{.</span><span class="typ">Address</span><span class="pun">}}:{{.</span><span class="typ">Port</span><span class="pun">}}{{</span><span class="kwd">end</span><span class="pun">}}</span><span class="pln">
frontend ft_redis
    bind </span><span class="pun">*:</span><span class="lit">6379</span><span class="pln"> name redis
    default_backend bk_redis
backend bk_redis</span><span class="pun">{{</span><span class="pln">range service </span><span class="str">"redis"</span><span class="pun">}}</span><span class="pln">
        server </span><span class="pun">{{.</span><span class="typ">Node</span><span class="pun">}}</span><span class="pln"> </span><span class="pun">{{.</span><span class="typ">Address</span><span class="pun">}}:{{.</span><span class="typ">Port</span><span class="pun">}}{{</span><span class="kwd">end</span><span class="pun">}}</span></code></pre>
<p>There are 3 listen blocks – one for webapps listening on default port 80, one for sinatra webapps listening on port 4567 and a redis section listening on port 6379.</p>
<p>We are ready to start the consul-template daemon:</p>
<pre class="prettyprint prettyprinted"><code><span class="pln">nohup consul</span><span class="pun">-</span><span class="kwd">template</span><span class="pln"> </span><span class="pun">-</span><span class="pln">config </span><span class="pun">/</span><span class="pln">data</span><span class="pun">/</span><span class="pln">cfg</span><span class="pun">/</span><span class="pln">consul</span><span class="pun">/</span><span class="pln">tmpl</span><span class="pun">.</span><span class="pln">json </span><span class="pun">&gt;</span><span class="pln"> consul</span><span class="pun">-</span><span class="kwd">template</span><span class="pun">.</span><span class="kwd">out</span><span class="pln"> </span><span class="lit">2</span><span class="pun">&gt;&amp;</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;</span></code></pre>
<p>At this point, whenever a docker service starts up with the name “web”, “demoapp” and or “redis”, the node, ip and port information will automatically get updated in our haproxy.cfg. The beauty of this is that we can now configure all of our apps to point to the statically-defined server and port of the haproxy instance for each service. Haproxy will then distribute the load automatically to the backend docker services running on their random assigned ports. If a backend docker container dies or stops, its node, ip and port info will be automatically removed from haproxy.cfg!</p>
<h2>Video Demo Showing Mesos, Consul, Consul-template and Registrator Working Together</h2>
<p><iframe width="560" height="315" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/yYbN2xWEs3c.html" frameborder="0" allowfullscreen=""></iframe></p>
                <div class="clear"></div>
								<p>Tags: <a href="http://philzim.com/tag/consul/" rel="tag">consul</a>, <a href="http://philzim.com/tag/docker/" rel="tag">docker</a>, <a href="http://philzim.com/tag/haproxy/" rel="tag">haproxy</a>, <a href="http://philzim.com/tag/marathon/" rel="tag">marathon</a>, <a href="http://philzim.com/tag/mesos/" rel="tag">mesos</a>, <a href="http://philzim.com/tag/orchestration/" rel="tag">orchestration</a>, <a href="http://philzim.com/tag/service-discovery/" rel="tag">service discovery</a>, <a href="http://philzim.com/tag/service-registration/" rel="tag">service registration</a></p>							</div>

			<div class="navigation">
				<div class="alignleft">« <a href="http://philzim.com/2014/10/13/using-fpm-to-build-git-rpms/" rel="prev">Using FPM to Build Git rpms</a></div>
				<div class="alignright"></div>
			</div>		
			
		</div>

	
<!-- You can start editing here. -->

	<h3 id="comments">19 Responses to “Service Discovery &amp; Orchestration With Mesos and Consul”</h3>

	<ul class="commentlist">

			<li class="comment even thread-even depth-1 parent" id="comment-106">
				<div id="div-comment-106" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/f1c2737dfe59c171747c6e8cffe55c8f" srcset="http://0.gravatar.com/avatar/f1c2737dfe59c171747c6e8cffe55c8f?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Spencer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-106">
			November 13, 2014 at 6:39 pm</a>		</div>

		<p>You have some html code which looks like it should be commands for the user to run</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=106#respond" onclick="return addComment.moveForm( &quot;div-comment-106&quot;, &quot;106&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to Spencer">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment byuser comment-author-pzimmerman-homegmail-com bypostauthor odd alt depth-2" id="comment-107">
				<div id="div-comment-107" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/0de5f2f20032ffe52e6cb865ff578709" srcset="http://0.gravatar.com/avatar/0de5f2f20032ffe52e6cb865ff578709?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">pzimmerman.home@gmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-107">
			November 13, 2014 at 7:17 pm</a>		</div>

		<p>Thanks for letting me know – wordpress markdown fail :-(. It should be fixed up now. I’ll have to work on improving the formatting later, but hopefully all commands should be readable now.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=107#respond" onclick="return addComment.moveForm( &quot;div-comment-107&quot;, &quot;107&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to pzimmerman.home@gmail.com">Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1 parent" id="comment-108">
				<div id="div-comment-108" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/516f16bffb19d112ee77351f33ee3bc4" srcset="http://2.gravatar.com/avatar/516f16bffb19d112ee77351f33ee3bc4?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">joel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-108">
			November 13, 2014 at 10:32 pm</a>		</div>

		<p>Nice work.  Is there a reason why you chose consul+haproxy over the haproxy bridge supplied from mesosphere?  <a href="https://github.com/mesosphere/marathon/blob/master/bin/haproxy-marathon-bridge" rel="nofollow">haproxy-marathon-bridge</a></p>
<p>I’m a big fan of consul but havent been able to justify a reason to use consul over the haproxy bridge other than sheer speed of a haproxy update.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=108#respond" onclick="return addComment.moveForm( &quot;div-comment-108&quot;, &quot;108&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to joel">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment byuser comment-author-pzimmerman-homegmail-com bypostauthor odd alt depth-2" id="comment-110">
				<div id="div-comment-110" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/0de5f2f20032ffe52e6cb865ff578709" srcset="http://0.gravatar.com/avatar/0de5f2f20032ffe52e6cb865ff578709?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">pzimmerman.home@gmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-110">
			November 14, 2014 at 3:46 pm</a>		</div>

		<p>Joel, we chose consul for a few reasons. First, I wanted a service discovery solution that could work with our legacy architectures as well as any new projects we run on mesos. In addition, I wanted a way to bootstrap the mesos cluster setup/configuration (masters and slaves) such that when they are provisioned, they will be auto-configured using data in consul. Think zk values, quorum, etc. I’ll be working on a solution for this very soon. Lastly, I really like how consul supports health-checks, which we will leverage heavily to ensure that only “healthy” services are actually registered. Like you mentioned, consul is very fast in updating the service info and that is very important as well.</p>
<p>Hope that helps,<br>
-Phil</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=110#respond" onclick="return addComment.moveForm( &quot;div-comment-110&quot;, &quot;110&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to pzimmerman.home@gmail.com">Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 parent" id="comment-134">
				<div id="div-comment-134" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/162552ff4734d86e87fd42bd98c90e6c" srcset="http://1.gravatar.com/avatar/162552ff4734d86e87fd42bd98c90e6c?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Gallagher Polyn</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-134">
			December 3, 2014 at 6:41 am</a>		</div>

		<p>Thanks for posting on this.</p>
<p>Not sure this is consistent with your intention in writing, but any future updates or comments on how to duplicate with more explicit references would help us duplicate what you’ve shown.</p>
<p><em><br>
How many nodes?</em></p><em>
<p>Of the nodes, which where hosts of which of your installed roles? For example, you used a three-server Consul cluster — how many additional Consul agents? Next, since you used a three-master Mesos cluster, if your screencast showed an additional two slaves, were there a total five nodes in your Mesos cluster?</p>
</em><p><em>Similarly, on which nodes is consul-template installed? Which node serves as the proxy?<br>
</em></p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=134#respond" onclick="return addComment.moveForm( &quot;div-comment-134&quot;, &quot;134&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to Gallagher Polyn">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment byuser comment-author-pzimmerman-homegmail-com bypostauthor odd alt depth-2" id="comment-140">
				<div id="div-comment-140" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/0de5f2f20032ffe52e6cb865ff578709" srcset="http://0.gravatar.com/avatar/0de5f2f20032ffe52e6cb865ff578709?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">pzimmerman.home@gmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-140">
			December 6, 2014 at 9:14 am</a>		</div>

		<p>Hi – thanks for the comment and questions. For our purposes in doing this labweek project, we wanted to create a production-type setup with clustered mesos masters and consul servers. All of this was done on our Openstack cloud. We created 3 vms to serve as mesos masters and consul servers (mesos and consul both on same 3 vms). Two additional vms were created to serve as mesos slaves/consul members (again mesos-slave and consul both on the 2 vms). Finally, 2 more vms were created to serve as haproxy nodes (one vm in each data center). Consul and consul-template are both installed on the haproxy nodes. In summary:</p>
<p>3 master vms: mesos-master and consul server</p>
<p>2 slave vms: mesos-slave and consul agent</p>
<p>2 haproxy vms: consul agent and consul-template</p>
<p>Hope this helps. Let me know if you have more questions.</p>
<p>-Phil</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=140#respond" onclick="return addComment.moveForm( &quot;div-comment-140&quot;, &quot;140&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to pzimmerman.home@gmail.com">Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1 parent" id="comment-157">
				<div id="div-comment-157" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/369ff6cf9bcb2bf69799587fb213c869" srcset="http://0.gravatar.com/avatar/369ff6cf9bcb2bf69799587fb213c869?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Graham</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-157">
			December 15, 2014 at 3:38 am</a>		</div>

		<p>Hey Phil,<br>
Great article. I’ve nearly got it all working, however when I launch a container from Marathon it does not get picked up by the Registrator container and pushed into Consul.</p>
<p>However if I launch a container via docker run (on the command line) it does… Did you have to do anything special to get this working form Marathon?</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=157#respond" onclick="return addComment.moveForm( &quot;div-comment-157&quot;, &quot;157&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to Graham">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment odd alt depth-2 parent" id="comment-158">
				<div id="div-comment-158" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/369ff6cf9bcb2bf69799587fb213c869" srcset="http://0.gravatar.com/avatar/369ff6cf9bcb2bf69799587fb213c869?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Graham</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-158">
			December 15, 2014 at 5:46 am</a>		</div>

		<p>I ran into this comment on the Google groups – <a href="https://groups.google.com/d/msg/marathon-framework/RNzT31IjM8M/jvGvqjk5CdgJ" rel="nofollow">https://groups.google.com/d/msg/marathon-framework/RNzT31IjM8M/jvGvqjk5CdgJ</a> which suggests you might have had a similar issue?</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=158#respond" onclick="return addComment.moveForm( &quot;div-comment-158&quot;, &quot;158&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to Graham">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment even depth-3 parent" id="comment-159">
				<div id="div-comment-159" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/369ff6cf9bcb2bf69799587fb213c869" srcset="http://0.gravatar.com/avatar/369ff6cf9bcb2bf69799587fb213c869?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Graham</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-159">
			December 15, 2014 at 8:04 am</a>		</div>

		<p>To (partly) answer my own question – I’m running into this issue – <a href="https://github.com/progrium/registrator/issues/28" rel="nofollow">https://github.com/progrium/registrator/issues/28</a></p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=159#respond" onclick="return addComment.moveForm( &quot;div-comment-159&quot;, &quot;159&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to Graham">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment odd alt depth-4 parent" id="comment-161">
				<div id="div-comment-161" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/369ff6cf9bcb2bf69799587fb213c869" srcset="http://0.gravatar.com/avatar/369ff6cf9bcb2bf69799587fb213c869?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Graham</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-161">
			December 16, 2014 at 6:48 am</a>		</div>

		<p>After upgrading docker to the latest version, this was all working</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=161#respond" onclick="return addComment.moveForm( &quot;div-comment-161&quot;, &quot;161&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to Graham">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment byuser comment-author-pzimmerman-homegmail-com bypostauthor even depth-5" id="comment-163">
				<div id="div-comment-163" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/0de5f2f20032ffe52e6cb865ff578709" srcset="http://0.gravatar.com/avatar/0de5f2f20032ffe52e6cb865ff578709?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">pzimmerman.home@gmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-163">
			December 16, 2014 at 4:38 pm</a>		</div>

		<p>Hi Graham – sorry for the late response – had to deal with an illness in the family. Glad you got this working! Let me know if you have any other questions</p>

		
				</div>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-even depth-1" id="comment-172">
				<div id="div-comment-172" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href="http://labs.gree.jp/blog/2014/12/11959/" rel="external nofollow" class="url">オーケストレーション入門 – 多種多様化するサービスをConsulで連携させる | GREE Engineers' Blog</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-172">
			December 18, 2014 at 8:01 am</a>		</div>

		<p>[…] Service Discovery &amp; Orchestration With Mesos and Consul […]</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=172#respond" onclick="return addComment.moveForm( &quot;div-comment-172&quot;, &quot;172&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to オーケストレーション入門 – 多種多様化するサービスをConsulで連携させる | GREE Engineers&#39; Blog">Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1 parent" id="comment-374">
				<div id="div-comment-374" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/16c379ccede4f2af7569f031c929067a" srcset="http://1.gravatar.com/avatar/16c379ccede4f2af7569f031c929067a?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Marcus</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-374">
			February 3, 2015 at 11:28 am</a>		</div>

		<p>Thanks for the great post! Couple questions:</p>
<p>For getting Consul to work with Mesos are you just pointing Mesos to the Consul endpoint with the –zk flag?<br>
Could I have 3 “Master” servers each running a Mesos and Consul Master service? Or do I need to have those separated?</p>
<p>Thanks!</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=374#respond" onclick="return addComment.moveForm( &quot;div-comment-374&quot;, &quot;374&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to Marcus">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment byuser comment-author-pzimmerman-homegmail-com bypostauthor odd alt depth-2" id="comment-376">
				<div id="div-comment-376" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/0de5f2f20032ffe52e6cb865ff578709" srcset="http://0.gravatar.com/avatar/0de5f2f20032ffe52e6cb865ff578709?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">pzimmerman.home@gmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-376">
			February 3, 2015 at 2:42 pm</a>		</div>

		<p>Hi, glad you liked it! We aren’t incorporating consul to work with mesos, but to complement mesos and help with service discovery and dynamic configuration. We use consul in other areas and it’s not tied to mesos, so we chose to have a consul cluster that is hosted separately from the mesos cluster. However, with mesos recently announcing built-in support for etcd, I’m hopeful built-in support for consul won’t be far behind. Hope this answers your question.</p>
<p>BTW, I will have another post fairly soon which details a federated graphite cluster using docker/consul/consul-template/registrator.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=376#respond" onclick="return addComment.moveForm( &quot;div-comment-376&quot;, &quot;376&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to pzimmerman.home@gmail.com">Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 parent" id="comment-427">
				<div id="div-comment-427" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/df818458a14756eb70203e20b7295524" srcset="http://1.gravatar.com/avatar/df818458a14756eb70203e20b7295524?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">ashish</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-427">
			February 20, 2015 at 8:56 pm</a>		</div>

		<p>That’s an excellent article and a demo. I have a question here. How do you configure the internal discovery. Say for example your container -1 is running a publish java code and container-2 is running rabbitmq. How do I make sure container-1 is able to automatically discover the host/port details of container-2. Basically more from an implementation- Do I have to write some java code and call ha-proxy apis etc??</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=427#respond" onclick="return addComment.moveForm( &quot;div-comment-427&quot;, &quot;427&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to ashish">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment byuser comment-author-pzimmerman-homegmail-com bypostauthor odd alt depth-2" id="comment-428">
				<div id="div-comment-428" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/0de5f2f20032ffe52e6cb865ff578709" srcset="http://0.gravatar.com/avatar/0de5f2f20032ffe52e6cb865ff578709?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">pzimmerman.home@gmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-428">
			February 21, 2015 at 7:49 am</a>		</div>

		<p>Thanks for the positive feedback!</p>
<p>Regarding your question, the answer is – it depends. Consul supports 2 methods of service lookup: dns and http (The consul website has excellent documentation and you can read more about both methods there). I’ve not used the dns method other than running some simple ‘dig’ commands to see what type of info gets returned. I’m guessing you might lean more towards using the http lookups instead, as those return json data. For example, if I wanted to lookup the host/port of my graphite postgresql db:</p>
<p>curl <a href="http://my.consul-server.com:8500/v1/catalog/service/graphite-db" rel="nofollow">http://my.consul-server.com:8500/v1/catalog/service/graphite-db</a></p>
<p>[<br>
  {<br>
    “Node”: “my-container-node.com”,<br>
    “Address”: “1.1.1.1”,<br>
    “ServiceID”: “my-container-node.com:mesos-17cf4ecc-d1be-4542-91b2-3779103a77c2:5432”,<br>
    “ServiceName”: “graphite-db”,<br>
    “ServiceTags”: null,<br>
    “ServicePort”: 31000<br>
  }<br>
]</p>
<p>Hope that helps</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=428#respond" onclick="return addComment.moveForm( &quot;div-comment-428&quot;, &quot;428&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to pzimmerman.home@gmail.com">Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even depth-2" id="comment-533">
				<div id="div-comment-533" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/82e6c9033e8b90f7593a548fbabba861" srcset="http://2.gravatar.com/avatar/82e6c9033e8b90f7593a548fbabba861?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Luis faustino</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-533">
			March 20, 2015 at 2:03 am</a>		</div>

		<p>If you start your app container with –dns= then you can have your app code reference Services in Consul by using .service.consul</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=533#respond" onclick="return addComment.moveForm( &quot;div-comment-533&quot;, &quot;533&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to Luis faustino">Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-438">
				<div id="div-comment-438" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/d2bbe890c6e806143e59dfc27be0d248" srcset="http://1.gravatar.com/avatar/d2bbe890c6e806143e59dfc27be0d248?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">sielaq</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-438">
			February 28, 2015 at 12:04 am</a>		</div>

		<p>Hi tehre,<br>
We are doing something simillar here:<br>
<a href="https://github.com/eBayClassifiedsGroup/paas-in-a-box" rel="nofollow">https://github.com/eBayClassifiedsGroup/paas-in-a-box</a></p>
<p>We have also added smoothly deregistering services form consul during rolling upgrade.<br>
so HAproxy always conatins ONLY running instances. Its needed when you do a lot of rolling upgrades and you want to avoid any downtime. Marathon via mesos stops containers (first SIGTERM and after 3 sec. – this time can be changed – SIGKILL. which means you havedocker cinater killed before registrator deregister it and haproxy still send traffic to it.</p>
<p>So you need to trap SIGTERM to avoid any 503</p>
<p>That was the most tricky part:<br>
 1. You need to TRAP SIGTERM and deregister (or maintanance mode) your consul instance<br>
 2. change your entrypoint to point for you trap script<br>
 3. in Marathon you need to use args instead of cmd to use your entrypoint<br>
 4. You need a wrapper for docker – to inject mesos container name, so you can easily deregister it (or put it into maintanance mode) in script mentioned in point 1.</p>
<p>All  of thise pieces are in the sandbox in link above,<br>
enjoy <img src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;"></p>
<p>SielaQ</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=438#respond" onclick="return addComment.moveForm( &quot;div-comment-438&quot;, &quot;438&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to sielaq">Reply</a></div>
				</div>
		<ul class="children">
		<li class="comment byuser comment-author-pzimmerman-homegmail-com bypostauthor even depth-2" id="comment-536">
				<div id="div-comment-536" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/0de5f2f20032ffe52e6cb865ff578709" srcset="http://0.gravatar.com/avatar/0de5f2f20032ffe52e6cb865ff578709?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">pzimmerman.home@gmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#comment-536">
			March 20, 2015 at 6:01 am</a>		</div>

		<p>Thanks for sharing. That looks like an interesting approach!</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/?replytocom=536#respond" onclick="return addComment.moveForm( &quot;div-comment-536&quot;, &quot;536&quot;, &quot;respond&quot;, &quot;100&quot; )" aria-label="Reply to pzimmerman.home@gmail.com">Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

	</ul>

 
<p></p>
<br>


				<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://philzim.com/2014/11/12/service-discovery-orchestration-with-mesos-and-consul/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="http://philzim.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><div class="wmd-panel"><div id="wmd-button-barcomment"><ul id="wmd-button-rowcomment" class="wmd-button-row"><li class="wmd-button" id="wmd-bold-buttoncomment" title="Strong &lt;strong&gt; Ctrl+B" style="left: 0px;"><span style="background-position: 0px 0px;"></span></li><li class="wmd-button" id="wmd-italic-buttoncomment" title="Emphasis &lt;em&gt; Ctrl+I" style="left: 25px;"><span style="background-position: -20px 0px;"></span></li><li class="wmd-spacer wmd-spacer1" id="wmd-spacer1comment"></li><li class="wmd-button" id="wmd-link-buttoncomment" title="Hyperlink &lt;a&gt; Ctrl+L" style="left: 75px;"><span style="background-position: -40px 0px;"></span></li><li class="wmd-button" id="wmd-quote-buttoncomment" title="Blockquote &lt;blockquote&gt; Ctrl+Q" style="left: 100px;"><span style="background-position: -60px 0px;"></span></li><li class="wmd-button" id="wmd-code-buttoncomment" title="Code Sample &lt;pre&gt;&lt;code&gt; Ctrl+K" style="left: 125px;"><span style="background-position: -80px 0px;"></span></li><li class="wmd-button" id="wmd-image-buttoncomment" title="Image &lt;img&gt; Ctrl+G" style="left: 150px;"><span style="background-position: -100px 0px;"></span></li><li class="wmd-spacer wmd-spacer2" id="wmd-spacer2comment"></li><li class="wmd-button" id="wmd-olist-buttoncomment" title="Numbered List &lt;ol&gt; Ctrl+O" style="left: 200px;"><span style="background-position: -120px 0px;"></span></li><li class="wmd-button" id="wmd-ulist-buttoncomment" title="Bulleted List &lt;ul&gt; Ctrl+U" style="left: 225px;"><span style="background-position: -140px 0px;"></span></li><li class="wmd-button" id="wmd-heading-buttoncomment" title="Heading &lt;h1&gt;/&lt;h2&gt; Ctrl+H" style="left: 250px;"><span style="background-position: -160px 0px;"></span></li><li class="wmd-button" id="wmd-hr-buttoncomment" title="Horizontal Rule &lt;hr&gt; Ctrl+R" style="left: 275px;"><span style="background-position: -180px 0px;"></span></li><li class="wmd-spacer wmd-spacer3" id="wmd-spacer3comment"></li><li class="wmd-button" id="wmd-undo-buttoncomment" title="Undo - Ctrl+Z" style="left: 325px;"><span style="background-position: -200px -20px;"></span></li><li class="wmd-button" id="wmd-redo-buttoncomment" title="Redo - Ctrl+Shift+Z" style="left: 350px;"><span style="background-position: -220px -20px;"></span></li><li class="wmd-button wmd-help-button" id="wmd-help-buttoncomment" title="Markdown Editing Help" style="right: 0px;"><span style="background-position: -240px 0px;"></span></li></ul></div><div id="wmd-button-bar-help" style="display: none;"> <p>To create code blocks or other preformatted text, indent by four spaces:</p>
        <pre class="wmd-help"><span class="wmd-help-spaces">&nbsp;&nbsp;&nbsp;&nbsp;</span>This will be displayed in a monospaced font. The first four 
<span class="wmd-help-spaces">&nbsp;&nbsp;&nbsp;&nbsp;</span>spaces will be stripped off, but all other whitespace
<span class="wmd-help-spaces">&nbsp;&nbsp;&nbsp;&nbsp;</span>will be preserved.
<span class="wmd-help-spaces">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span class="wmd-help-spaces">&nbsp;&nbsp;&nbsp;&nbsp;</span>Markdown is turned off in code blocks:
<span class="wmd-help-spaces">&nbsp;&nbsp;&nbsp;&nbsp;</span> [This is not a link](http://example.com)
</pre>
        <p>
            To create not a block, but an inline code span, use backticks:
        </p>
        <pre class="wmd-help">Here is some inline `code`.</pre> <p>For more help see <a href="http://daringfireball.net/projects/markdown/syntax" rel="no-follow"> http://daringfireball.net/projects/markdown/syntax</a></p></div><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" aria-required="true" required="required"></textarea></p><div id="wmd-previewcomment" class="wmd-panel wmd-preview prettyprint"></div></div><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required="true" required="required"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-describedby="email-notes" aria-required="true" required="required"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30"></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="100" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="93318ef5b8"></p><p style="display: none;"></p>				<input type="hidden" id="ak_js" name="ak_js" value="1458396852910"></form>
					</div><!-- #respond -->
		




	
	</div>
	<!-- End: Left Panel -->
	<!-- Start: Right Panel -->
	<div class="rightPan">
		<span class="topBg"></span>
	<div class="inner">
	
			<div class="widgetBlock">
				<h2>Category</h2>
				<ul>
			        	<li class="cat-item cat-item-32"><a href="http://philzim.com/category/consul-2/">Consul</a> (1)
</li>
	<li class="cat-item cat-item-17"><a href="http://philzim.com/category/devops/">devops</a> (1)
</li>
	<li class="cat-item cat-item-24"><a href="http://philzim.com/category/docker/">docker</a> (1)
</li>
	<li class="cat-item cat-item-22"><a href="http://philzim.com/category/git/">Git</a> (1)
</li>
	<li class="cat-item cat-item-9"><a href="http://philzim.com/category/hubot-2/">Hubot</a> (2)
</li>
	<li class="cat-item cat-item-23"><a href="http://philzim.com/category/mesos/">mesos</a> (1)
</li>
	<li class="cat-item cat-item-16"><a href="http://philzim.com/category/monitoring/">monitoring</a> (1)
</li>
	<li class="cat-item cat-item-25"><a href="http://philzim.com/category/paas/">PaaS</a> (1)
</li>
	<li class="cat-item cat-item-8"><a href="http://philzim.com/category/puppet-2/">Puppet</a> (4)
</li>
				</ul>
			</div>				
			
			<div class="widgetBlock">
				<h2>Archives</h2>
				<ul>
						<li><a href="http://philzim.com/2014/11/">November 2014</a></li>
	<li><a href="http://philzim.com/2014/10/">October 2014</a></li>
	<li><a href="http://philzim.com/2014/05/">May 2014</a></li>
	<li><a href="http://philzim.com/2014/04/">April 2014</a></li>
				</ul>
			</div>	
			<div class="widgetBlock">
				<iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" class="twitter-timeline twitter-timeline-rendered" style="position: static; visibility: visible; display: inline-block; width: 520px; height: 600px; padding: 0px; border: none; max-width: 100%; min-width: 180px; margin-top: 0px; margin-bottom: 0px; min-height: 200px;" data-widget-id="418794153573502976"></iframe>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
			</div>	
			
				</div>
<span class="bottomBg"></span>
	</div>
	<!-- End: Right Panel -->
	
</div>
	<!-- End: Body Content -->
</div>
<!-- End: Main Container -->
</div>
<!-- Start: Footer -->
<div class="footer">
	<div class="inner">
		<p class="logo">My Tech Musings and Stuff I Want to Remember</p>
		<div class="right">
			 <ul class="menu"><li class="page_item page-item-2"><a href="http://philzim.com/sample-page/">About Me</a></li>
</ul>						<div class="credits">Powered by <a href="http://wordpress.org/">Wordpress</a>. Design by <a href="http://handla-online.org/">Handla-Online.org</a>.</div>
		</div>
	</div>
</div>
<!-- End: Footer -->

<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/form.js"></script>
<link rel="stylesheet" id="wp-markdown-editor-css" href="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/markdown-editor.css" type="text/css" media="all">
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/photon.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/devicepx-jetpack.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/wp-embed.min.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/markdown.min.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/markdown-converter.min.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/markdown-sanitizer.min.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/markdown-editor.min.js"></script>
<script type="text/javascript" src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/e-201611.js" async="" defer=""></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:3.9.4',blog:'67381653',post:'100',tz:'-6',srv:'philzim.com'} ]);
	_stq.push([ 'clickTrackerInit', '67381653', '100' ]);
</script>


<img src="./Service Discovery &amp; Orchestration With Mesos and Consul _ My Tech Musings and Stuff I Want to Remember_files/g.gif" id="wpstats"><iframe id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;"></iframe></body></html>